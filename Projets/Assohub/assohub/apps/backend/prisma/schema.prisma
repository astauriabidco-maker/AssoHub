generator client {
  provider        = "prisma-client-js"
  engineType      = "library"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
}

model Association {
  id             String        @id @default(uuid())
  slug           String?       @unique
  name           String
  slogan         String?
  description    String?
  logo_url       String?
  address_street String?
  address_city   String?
  address_zip    String?
  address_country String?
  contact_email  String?
  contact_phone  String?
  legal_form     String?
  settings       Json
  subscription_plan String      @default("FREE")
  is_active      Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  announcements  Announcement[]
  campaigns      Campaign[]
  documents      Document[]
  events         Event[]
  groups         Group[]
  transactions   Transaction[]
  users          User[]
}

model User {
  id                 String              @id @default(uuid())
  associationId      String
  email              String
  password_hash      String
  firstName          String?
  lastName           String?
  phone              String?
  role               Role                @default(MEMBER)
  status             UserStatus          @default(ACTIVE)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  announcements      Announcement[]
  eventRegistrations EventRegistration[]
  fees               Fee[]
  ledGroups          Group[]             @relation("GroupLeader")
  association        Association         @relation(fields: [associationId], references: [id])
  memberOfGroups     Group[]             @relation("GroupMembers")
  history            MemberHistory[]

  @@unique([email, associationId])
}

model MemberHistory {
  id          String   @id @default(uuid())
  userId      String
  action      String
  description String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
}

model Group {
  id            String      @id @default(uuid())
  associationId String
  name          String
  description   String?
  leaderId      String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  leader        User?       @relation("GroupLeader", fields: [leaderId], references: [id])
  association   Association @relation(fields: [associationId], references: [id])
  members       User[]      @relation("GroupMembers")
}

model Campaign {
  id            String      @id @default(uuid())
  associationId String
  name          String
  amount        Float
  due_date      DateTime
  auto_reminder Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  association   Association @relation(fields: [associationId], references: [id])
  fees          Fee[]
}

model Fee {
  id                 String       @id @default(uuid())
  userId             String
  campaignId         String
  status             FeeStatus    @default(PENDING)
  payment_link_token String?      @unique
  last_reminder_at   DateTime?
  reminder_count     Int          @default(0)
  paidAt             DateTime?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  campaign           Campaign     @relation(fields: [campaignId], references: [id])
  user               User         @relation(fields: [userId], references: [id])
  transaction        Transaction?
}

model Transaction {
  id              String          @id @default(uuid())
  associationId   String
  amount          Float
  type            TransactionType
  description     String?
  category        String?
  paymentMethod   String?
  date            DateTime        @default(now())
  feeId           String?         @unique
  proofDocumentId String?         @unique
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  proofDocument   Document?       @relation(fields: [proofDocumentId], references: [id])
  fee             Fee?            @relation(fields: [feeId], references: [id])
  association     Association     @relation(fields: [associationId], references: [id])
}

model Event {
  id            String              @id @default(uuid())
  associationId String
  title         String
  description   String?
  location      String?
  start_date    DateTime
  end_date      DateTime?
  is_paid       Boolean             @default(false)
  price         Float?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  association   Association         @relation(fields: [associationId], references: [id])
  registrations EventRegistration[]
  documents     Document[]
}

model EventRegistration {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  status    String   @default("REGISTERED")
  has_paid  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  event     Event    @relation(fields: [eventId], references: [id])
}

model Document {
  id            String       @id @default(uuid())
  associationId String
  eventId       String?
  name          String
  file_path     String
  category      DocCategory
  access_level  AccessLevel  @default(ADMIN_ONLY)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  association   Association  @relation(fields: [associationId], references: [id])
  event         Event?       @relation(fields: [eventId], references: [id])
  transaction   Transaction?
}

enum Role {
  SUPER_ADMIN
  ADMIN
  PRESIDENT
  VICE_PRESIDENT
  SECRETARY
  TREASURER
  MEMBER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum FeeStatus {
  PENDING
  PAID
  OVERDUE
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum DocCategory {
  AG_REPORT
  INVOICE
  STATUTS
  OTHER
}

enum AccessLevel {
  PUBLIC
  MEMBERS_ONLY
  ADMIN_ONLY
}

model Announcement {
  id            String      @id @default(uuid())
  associationId String
  title         String
  content       String
  authorId      String
  createdAt     DateTime    @default(now())
  association   Association @relation(fields: [associationId], references: [id])
  author        User        @relation(fields: [authorId], references: [id])
}
